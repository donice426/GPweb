<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Defectos | GP Graders</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg0:#070e18;
      --bg2:#0f1e33;
      --text:#eaf1ff;
      --muted:#b9c6e3;

      --panel: rgba(255,255,255,.05);
      --stroke: rgba(255,255,255,.12);

      --brand:#4da3ff;
      --brand2:#38d4ff;

      --shadow: 0 18px 60px rgba(0,0,0,.52);
      --shadow2: 0 28px 90px rgba(0,0,0,.68);

      --r:16px;
      --r20:20px;

      --easeOut: cubic-bezier(.16,.84,.44,1);
      --easeIn: cubic-bezier(.6,0,.4,1);

      --max: 1100px;
    }

    *{ box-sizing: border-box; }

    html, body{ height: 100%; }
    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(77,163,255,.18), transparent 60%),
        radial-gradient(900px 600px at 80% 90%, rgba(77,163,255,.10), transparent 55%),
        linear-gradient(135deg, var(--bg0), var(--bg2));
      overflow-x:hidden;
    }

    /* Ambient glow */
    body::before{
      content:"";
      position:fixed;
      inset:-40px;
      pointer-events:none;
      background:
        radial-gradient(520px 320px at 18% 18%, rgba(77,163,255,.14), transparent 62%),
        radial-gradient(520px 320px at 85% 82%, rgba(56,212,255,.10), transparent 64%);
      opacity:.95;
      animation: bgFloat 10s ease-in-out infinite alternate;
      z-index:0;
    }
    @keyframes bgFloat{
      from{ transform: translate3d(-10px,-6px,0) scale(1); }
      to  { transform: translate3d(10px,8px,0) scale(1.02); }
    }

    /* Sticky header */
    header{
      position:sticky;
      top:0;
      background:rgba(8,14,24,.90);
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      z-index:10;
      transform: translateY(-6px);
      opacity:0;
      animation: fadeDown .45s var(--easeOut) forwards;
    }
    @keyframes fadeDown{ to{ transform: translateY(0); opacity:1; } }

    header .wrap{
      max-width:var(--max);
      margin:auto;
      padding:14px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    header h1{ margin:0; font-size:16px; }
    header span{ font-size:12px; color:var(--muted); }

    .btn{
      padding:9px 14px;
      border-radius:12px;
      text-decoration:none;
      font-weight:700;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.05);
      color:var(--text);
      cursor:pointer;
      transition: transform .15s var(--easeOut), border-color .15s var(--easeOut),
                  box-shadow .15s var(--easeOut), background .15s var(--easeOut);
      position:relative;
      overflow:hidden;
      will-change: transform;
    }
    .btn::after{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(420px 140px at 10% 10%, rgba(77,163,255,.18), transparent 65%);
      opacity:0;
      transition: opacity .2s var(--easeOut);
      pointer-events:none;
    }
    .btn:hover{
      border-color: rgba(77,163,255,.55);
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(0,0,0,.28);
      background: rgba(0,0,0,.10);
    }
    .btn:hover::after{ opacity:1; }
    .btn:active{ transform: translateY(0) scale(.99); }
    .btn.primary{
      border-color: rgba(77,163,255,.55);
      background: linear-gradient(180deg, rgba(77,163,255,.18), rgba(56,212,255,.12));
    }
    .btn.primary:hover{ border-color: rgba(77,163,255,.85); }

    main{
      max-width:var(--max);
      margin:auto;
      padding:26px 18px 50px;
      position:relative;
      z-index:1;
    }

    .section{ margin-top:40px; }
    .section-title{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:8px;
    }
    .bar{
      width:10px;
      height:22px;
      border-radius:8px;
      background:linear-gradient(180deg,var(--brand),var(--brand2));
      box-shadow: 0 10px 26px rgba(77,163,255,.10);
    }
    .section-title h2{ margin:0; font-size:18px; }
    .section-sub{
      font-size:13px;
      color:var(--muted);
      margin-bottom:18px;
      max-width:850px;
      line-height:1.6;
    }

    footer{
      text-align:center;
      font-size:12px;
      color:rgba(255,255,255,.42);
      padding:20px;
      position:relative;
      z-index:1;
    }

    /* ===== BUSCADOR ===== */
    .search-wrap{
      margin-top:14px;
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow: visible; /* autocomplete */
      transform: translateY(10px);
      opacity:0;
      transition: transform .55s var(--easeOut), opacity .55s var(--easeOut);
    }
    .search-wrap.reveal{ transform: translateY(0); opacity:1; }

    .search-head{
      padding:14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .search-head h3{ margin:0; font-size:14px; }
    .search-head .hint{ margin-top:4px; font-size:12px; color:var(--muted); }

    .search-body{ padding: 14px 16px 16px; }
    .search-row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .search-suggest{
      position: relative;
      flex: 1;
      min-width: 220px;
    }
    .search-input{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      transition: border-color .15s var(--easeOut), box-shadow .15s var(--easeOut), transform .15s var(--easeOut);
    }
    .search-input:focus{
      border-color: rgba(77,163,255,.55);
      box-shadow: 0 0 0 6px rgba(77,163,255,.12);
      transform: translateY(-1px);
    }
    .search-meta{
      margin-top:10px;
      font-size:12px;
      color: rgba(230,237,245,.60);
    }

    mark.gp-hit{
      background: rgba(77,163,255,.25);
      border: 1px solid rgba(77,163,255,.35);
      color: var(--text);
      padding: 0 2px;
      border-radius: 6px;
      transition: box-shadow .2s var(--easeOut), background .2s var(--easeOut), border-color .2s var(--easeOut);
    }
    mark.gp-hit.active{
      background: rgba(77,163,255,.45);
      border-color: rgba(77,163,255,.75);
      box-shadow: 0 0 0 6px rgba(77,163,255,.14);
      animation: popHit .28s var(--easeOut);
    }
    @keyframes popHit{ from{ transform: scale(.98); } to{ transform: scale(1); } }

    /* Autocomplete */
    .suggest-list{
      position:absolute;
      top: calc(100% + 8px);
      left:0; right:0;
      background: rgba(10,20,34,.98);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 14px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      overflow:hidden;
      z-index:999;
      max-height:280px;
      overflow-y:auto;
      display:none;
      transform-origin: top;
      animation: drop .16s var(--easeOut);
    }
    @keyframes drop{
      from{ transform: translateY(-6px) scale(.98); opacity:.4; }
      to{ transform: translateY(0) scale(1); opacity:1; }
    }
    .suggest-item{
      padding:10px 12px;
      cursor:pointer;
      border-top: 1px solid rgba(255,255,255,.08);
      transition: background .12s var(--easeOut), transform .12s var(--easeOut);
    }
    .suggest-item:first-child{ border-top:none; }
    .suggest-item:hover,
    .suggest-item.active{ background: rgba(77,163,255,.12); transform: translateX(2px); }
    .suggest-title{
      font-size:13px;
      color: rgba(230,237,245,.92);
      line-height:1.35;
    }
    .suggest-hi{
      background: rgba(77,163,255,.22);
      border: 1px solid rgba(77,163,255,.35);
      padding:0 2px;
      border-radius:6px;
    }

    /* Selector */
    .defect-selector{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      margin-top:10px;
      transform: translateY(10px);
      opacity:0;
      transition: transform .55s var(--easeOut), opacity .55s var(--easeOut);
    }
    .defect-selector.reveal{ transform: translateY(0); opacity:1; }

    .defect-btn{
      flex:1;
      min-width:220px;
      padding:14px 16px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      color:var(--text);
      font-weight:800;
      cursor:pointer;
      text-align:left;
      transition: transform .15s var(--easeOut), border-color .15s var(--easeOut), box-shadow .15s var(--easeOut);
      position:relative;
      overflow:hidden;
      will-change: transform;
    }
    .defect-btn span{
      display:block;
      font-size:12px;
      font-weight:400;
      color:var(--muted);
      margin-top:4px;
      line-height:1.45;
    }
    .defect-btn::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius:16px;
      background: radial-gradient(520px 220px at 10% 0%, rgba(77,163,255,.14), transparent 60%);
      opacity:0;
      transition: opacity .18s var(--easeOut);
      pointer-events:none;
    }
    .defect-btn:hover{ transform: translateY(-2px); }
    .defect-btn:hover::before{ opacity:1; }
    .defect-btn.color:hover{
      border-color: rgba(77,163,255,.75);
      box-shadow: 0 0 0 6px rgba(77,163,255,.12);
    }
    .defect-btn.nir:hover{
      border-color: rgba(56,212,255,.75);
      box-shadow: 0 0 0 6px rgba(56,212,255,.12);
    }
    .defect-btn:active{ transform: translateY(-1px) scale(.99); }

    /* Grid */
    .defects-grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:16px;
      margin-top:16px;
    }
    @media (max-width: 1100px){ .defects-grid{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 800px){ .defects-grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 480px){ .defects-grid{ grid-template-columns: 1fr; } }

    /* Card */
    .defect-card{
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      max-width:260px;
      margin:0 auto;
      position:relative;
      will-change: transform;

      transform: translateY(10px);
      opacity:0;
    }
    .defect-card.reveal{
      transform: translateY(0);
      opacity:1;
      transition: transform .55s var(--easeOut), opacity .55s var(--easeOut), border-color .15s var(--easeOut), box-shadow .15s var(--easeOut);
    }
    .defect-card::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: 18px;
      background: radial-gradient(520px 220px at 10% 0%, rgba(77,163,255,.10), transparent 60%);
      opacity:0;
      transition: opacity .18s var(--easeOut);
      pointer-events:none;
    }
    .defect-card:hover{
      transform: translateY(-2px);
      border-color: rgba(77,163,255,.30);
      box-shadow: 0 22px 70px rgba(0,0,0,.45);
    }
    .defect-card:hover::before{ opacity:1; }
    .defect-card:active{ transform: translateY(-1px) scale(.995); }

    .defect-thumb{
      width:100%;
      aspect-ratio: 1 / 1;
      background: rgba(0,0,0,.18);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      padding:12px;
    }
    .defect-thumb img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      transform: translateZ(0);
      transition: transform .18s var(--easeOut), filter .18s var(--easeOut);
    }
    .defect-card:hover .defect-thumb img{
      transform: scale(1.02);
      filter: contrast(1.02);
    }
    .defect-names{ padding:10px 12px 12px; }
    .defect-names .es{ font-size:13px; font-weight:900; letter-spacing:.2px; }
    .defect-names .en{ font-size:11.5px; color: rgba(234,241,255,.78); margin-top:3px; }

    /* =========================================================
       MODAL NUEVO (desde 0) ‚Äî scroll perfecto en m√≥vil
       ========================================================= */

    /* overlay */
    .gpModalOverlay{
      position:fixed;
      inset:0;
      z-index:6000;
      display:none;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 14px;
    }
    .gpModalOverlay.is-open{
      display:flex;
      align-items:center;
      justify-content:center;
      animation: gpOverlayIn .18s var(--easeOut);
    }
    @keyframes gpOverlayIn{ from{ opacity:0; } to{ opacity:1; } }

    /* panel */
    .gpModal{
      width: min(980px, 100%);
      height: min(92dvh, 920px);       /* ‚úÖ usa dvh (iOS/Android) */
      max-height: 92dvh;
      background: rgba(8,14,24,.96);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 22px;
      box-shadow: var(--shadow2);
      overflow:hidden;

      display:flex;
      flex-direction:column;

      transform: translateY(12px) scale(.985);
      opacity:0;
      animation: gpModalIn .20s var(--easeOut) forwards;
    }
    @keyframes gpModalIn{
      to{ transform: translateY(0) scale(1); opacity:1; }
    }

    /* handle (m√≥vil) */
    .gpModalHandle{
      display:none;
      width: 44px;
      height: 5px;
      border-radius:999px;
      background: rgba(255,255,255,.18);
      margin: 10px auto 0;
      flex: 0 0 auto;
    }

    /* header sticky */
    .gpModalHead{
      position: sticky;
      top: 0;
      z-index: 4;
      padding: 14px 14px 12px;
      background: rgba(8,14,24,.96);
      border-bottom: 1px solid rgba(255,255,255,.10);

      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .gpModalTitle{ margin:0; font-size:16px; letter-spacing:.2px; }
    .gpModalSub{ margin:4px 0 0; font-size:12px; color: var(--muted); line-height:1.35; }

    .gpClose{
      width: 44px;
      height: 40px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: var(--text);
      cursor:pointer;
      font-weight:900;
      transition: transform .14s var(--easeOut), border-color .14s var(--easeOut), box-shadow .14s var(--easeOut);
      flex: 0 0 auto;
    }
    .gpClose:hover{
      border-color: rgba(77,163,255,.55);
      box-shadow: 0 14px 36px rgba(0,0,0,.35);
      transform: translateY(-1px);
    }
    .gpClose:active{ transform: translateY(0) scale(.99); }

    /* badge */
    .gpBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:10px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      font-size:12px;
      color: rgba(230,237,245,.90);
      width: fit-content;
    }
    .gpDot{ width: 8px; height: 8px; border-radius:999px; background: rgba(77,163,255,.9); }
    .gpBadge.nir .gpDot{ background: rgba(56,212,255,.9); }

    /* body scrolleable REAL (no se corta) */
    .gpModalBody{
      flex:1;
      min-height:0;                  /* ‚úÖ CR√çTICO para scroll en flex */
      overflow:auto;                 /* ‚úÖ scroll aqu√≠ */
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      padding: 14px;
      padding-bottom: calc(18px + env(safe-area-inset-bottom)); /* ‚úÖ iPhone */
    }

    /* layout interno */
    .gpGrid{
      display:grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 12px;
      align-items:start;
    }
    .gpFigure{ grid-column: 1 / 2; }
    .gpInfo{ grid-column: 2 / 3; }
    .gpSteps{ grid-column: 1 / 3; }

    .gpCard{
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      box-shadow: 0 10px 34px rgba(0,0,0,.22);
      overflow:hidden;
      position:relative;
    }

    .gpCardHead{
      padding: 12px 12px 0;
    }
    .gpCardTitle{
      margin:0;
      font-size: 13px;
      letter-spacing:.15px;
    }
    .gpText{
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.6;
      margin: 10px 0 0;
    }
    .gpPad{ padding: 12px; }

    /* figure */
    .gpFigureImg{
      width:100%;
      aspect-ratio: 16/10;
      background: rgba(0,0,0,.18);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 10px;
    }
    .gpFigureImg img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      cursor: zoom-in;
      transform: translateZ(0);
      transition: transform .18s var(--easeOut), filter .18s var(--easeOut);
    }
    .gpFigureImg img:hover{
      transform: scale(1.01);
      filter: contrast(1.02);
    }
    .gpCaption{
      padding: 10px 12px 12px;
      font-size:12px;
      color: var(--muted);
      border-top: 1px solid rgba(255,255,255,.08);
    }

    /* info list */
    .gpList{
      margin: 10px 0 0 18px;
      padding: 0 0 4px 0;
    }
    .gpList li{
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.55;
      margin: 8px 0;
    }
    .gpList b{ color: rgba(234,241,255,.92); }

    /* accordion */
    .gpAccBtn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px;
      border: 0;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      color: var(--text);
      cursor:pointer;
      font-weight: 900;
      font-size: 13px;
      transition: background .15s var(--easeOut);
    }
    .gpAccBtn:hover{ background: rgba(0,0,0,.18); }
    .gpAccIcon{
      transition: transform .18s var(--easeOut);
      opacity:.9;
    }
    .gpAccBtn[aria-expanded="true"] .gpAccIcon{ transform: rotate(180deg); }

    .gpAccPanel{
      padding: 12px;
      animation: gpAccIn .18s var(--easeOut);
    }
    @keyframes gpAccIn{
      from{ opacity:.25; transform: translateY(-6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .gpStepsGrid{ display:grid; gap: 10px; }
    .gpStep{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .gpStepN{ font-weight: 900; font-size: 12px; color: rgba(230,237,245,.92); }
    .gpStepT{ margin-top: 6px; font-size: 12px; color: var(--muted); line-height: 1.5; }

    .gpNote{
      margin: 10px 0 0;
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.55;
    }
    .gpNote b{ color: rgba(234,241,255,.92); }

    /* lightbox */
    .gpLightbox{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 7000;
      cursor: zoom-out;
      opacity:0;
      transition: opacity .14s var(--easeOut);
      padding: 14px;
    }
    .gpLightbox.is-open{
      display:flex;
      opacity:1;
    }
    .gpLightbox img{
      max-width: 92vw;
      max-height: 92dvh;
      border-radius: 14px;
      box-shadow: 0 30px 90px rgba(0,0,0,.70);
      transform: translateY(8px) scale(.99);
      animation: gpLbIn .16s var(--easeOut) forwards;
    }
    @keyframes gpLbIn{ to{ transform: translateY(0) scale(1); } }

    /* Mobile modal: bottom sheet */
    @media (max-width: 820px){
      .gpModalOverlay{
        padding: 10px;
        align-items:flex-end;
        justify-content:center;
      }
      .gpModal{
        width:100%;
        height: 92dvh;
        max-height: 92dvh;
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
      }
      .gpModalHandle{ display:block; }

      .gpModalBody{
        padding: 12px;
        padding-bottom: calc(20px + env(safe-area-inset-bottom));
      }

      .gpGrid{
        grid-template-columns: 1fr;
      }
      .gpFigure, .gpInfo, .gpSteps{ grid-column: auto; }
    }

    /* Hide top header when modal open (como pediste) */
    body.modal-open header{ display:none; }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
      body::before{ display:none; }
    }

    html, body{
  min-height: 100%;
}

body{
  margin:0;
  font-family:"Segoe UI", Tahoma, sans-serif;
  color:#eaf1ff;

  /* ‚úÖ FONDO GLOBAL */
  background:
    radial-gradient(1200px 800px at 10% 10%, rgba(77,163,255,.18), transparent 60%),
    radial-gradient(1200px 900px at 90% 90%, rgba(56,212,255,.12), transparent 55%),
    linear-gradient(135deg, #070e18, #0f1e33);

  background-attachment: fixed; /* üî• clave para continuidad visual */
  overflow-x:hidden;
}

  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div>
        <h1>Defectos ‚Äì GP Graders</h1>
        <span>Cat√°logo visual de defectos de cereza (MultiView‚Ñ¢ Color + NIR)</span>
      </div>
      <a href="menu.html" class="btn">‚¨Ö Volver al men√∫</a>
    </div>
  </header>

  <main>
    <!-- ===== BUSCADOR ===== -->
    <section class="search-wrap" id="buscador">
      <div class="search-head">
        <div>
          <h3>B√∫squeda r√°pida en el cat√°logo</h3>
          <div class="hint">Busca por nombre de defecto, palabra clave o criterio visual</div>
        </div>
        <button class="btn" id="clearSearchBtn" type="button">Limpiar</button>
      </div>

      <div class="search-body">
        <div class="search-row">
          <div class="search-suggest">
            <input class="search-input" id="searchInput" type="text" autocomplete="off"
              placeholder="Ej: cracking, pitting, pudrici√≥n, deshidrataci√≥n, NIR...">
            <div class="suggest-list" id="suggestList"></div>
          </div>

          <button class="btn primary" id="searchBtn" type="button">Buscar</button>
          <button class="btn" id="prevBtn" type="button">‚óÄ</button>
          <button class="btn" id="nextBtn" type="button">‚ñ∂</button>
        </div>

        <div class="search-meta" id="searchMeta">Sin b√∫squeda activa.</div>
      </div>
    </section>

    <!-- 1. INTRODUCCI√ìN DEFECTOS -->
    <section class="section" id="introduccion-defectos">
      <div class="section-title">
        <div class="bar"></div>
        <h2>1. Introducci√≥n al cat√°logo de defectos</h2>
      </div>

      <p class="section-sub">
        En el contexto de clasificaci√≥n de cerezas, un <strong>defecto</strong> se entiende como cualquier condici√≥n
        visual, estructural o fisiol√≥gica del fruto que disminuye su calidad comercial, su vida √∫til o su aptitud para
        el proceso de empaque. Estos defectos pueden manifestarse como alteraciones de piel (marcas, heridas, cracking),
        des√≥rdenes de textura (pitting, ablandamiento), contaminaci√≥n (suciedad), da√±os mec√°nicos o signos de descomposici√≥n.
      </p>

      <p class="section-sub">
        El prop√≥sito de esta secci√≥n es construir un <strong>cat√°logo estandarizado</strong> que permita:
        (1) identificar r√°pidamente cada defecto por su <strong>nombre</strong> y su manifestaci√≥n t√≠pica,
        (2) comprender c√≥mo se expresa en im√°genes <strong>MultiView‚Ñ¢ (Color + NIR)</strong>, y
        (3) servir como gu√≠a pr√°ctica para <strong>configurar defectos dentro de gpVision‚Ñ¢</strong>.
      </p>

      <p class="section-sub">
        En gpVision‚Ñ¢, los defectos no son solo etiquetas descriptivas: representan <strong>reglas y criterios</strong>
        que el sistema utiliza para asignar una condici√≥n al fruto y decidir su destino (clase/salida). Por ello,
        conocer el defecto por nombre y reconocerlo visualmente es fundamental.
      </p>

      <p class="section-sub" style="margin-top:-6px;">
        <strong>C√≥mo usar este cat√°logo:</strong> cada defecto se presentar√° con una definici√≥n breve, se√±ales t√≠picas,
        confusiones comunes y una orientaci√≥n pr√°ctica de configuraci√≥n en gpVision‚Ñ¢.
      </p>
    </section>

    <p class="section-sub">
      A continuaci√≥n se listan los defectos documentados, organizados para facilitar tanto el aprendizaje visual
      como la configuraci√≥n t√©cnica dentro de la plataforma gpVision‚Ñ¢.
    </p>

    <!-- 2. SELECTOR -->
    <section class="section" id="selector-defectos">
      <div class="section-title">
        <div class="bar"></div>
        <h2>2. Tipo de detecci√≥n del defecto</h2>
      </div>

      <p class="section-sub">
        En gpVision‚Ñ¢, los defectos se clasifican seg√∫n el tipo de informaci√≥n visual utilizada.
        Algunos defectos se identifican por <strong>caracter√≠sticas visibles en color</strong>, mientras que otros
        requieren <strong>informaci√≥n infrarroja (NIR)</strong>.
      </p>

      <div class="defect-selector">
        <button class="defect-btn color" data-target="defectos-color">
          Defectos detectados por Color
          <span>Basados en apariencia visual: color, textura, forma y marcas externas</span>
        </button>

        <button class="defect-btn nir" data-target="defectos-nir">
          Defectos detectados por Infrarrojo (NIR)
          <span>Basados en respuesta espectral: da√±o interno, descomposici√≥n, humedad</span>
        </button>
      </div>
    </section>

    <!-- 3. COLOR -->
    <section class="section" id="defectos-color">
      <div class="section-title">
        <div class="bar"></div>
        <h2>Defectos detectados por color</h2>
      </div>

      <p class="section-sub">
        Los defectos detectados por color se identifican a partir de informaci√≥n visible capturada por las c√°maras RGB.
      </p>

<div class="defects-grid">

      <article class="defect-card"
        data-type="color"
        data-es="Partidura"
        data-en="Cracking"
        data-img="Imagenes/Screenshot 2025-12-31 013121.png"
        data-desc="La partidura corresponde a una ruptura de la piel del fruto, generalmente causada por absorci√≥n excesiva de agua durante la etapa de precosecha o lluvia cercana a cosecha."
        data-signals="Grietas visibles en la piel, bordes irregulares, alto contraste en imagen RGB"
        data-confusions="Marcas superficiales, cicatrices naturales, da√±o mec√°nico leve"
        data-impact="Disminuci√≥n severa de la calidad comercial y reducci√≥n de vida √∫til"
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
        data-step2="Seleccionar o crear el defecto (spectro) 'Partidura / Cracking'."
        data-step3="Ajustar par√°metros de segmentaci√≥n y umbrales de color."
        data-step4="Validar el defecto usando im√°genes recientes del sistema MultiView‚Ñ¢."
        data-step5="Guardar la configuraci√≥n y monitorear falsos positivos."
        data-notes="Recomendaci√≥n: validar por √°ngulos y revisar falsos positivos en cicatrices superficiales."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Partidura (Cracking)">
        </div>
        <div class="defect-names">
          <div class="es">Partidura</div>
          <div class="en">Cracking</div>
        </div>
      </article>

      <article class="defect-card"
        data-type="color"
        data-es="Picadura de p√°jaro"
        data-en="Bird Peck"
        data-img="Imagenes/DEFECTO_BIRD_PECK_COLOR.jpeg"
        data-desc="La picadura de p√°jaro corresponde a un da√±o mec√°nico localizado causado por aves durante la etapa de precosecha. Se manifiesta como perforaciones o √°reas irregulares en la piel del fruto, frecuentemente con p√©rdida de tejido, bordes rasgados y exposici√≥n de pulpa."
        data-signals="Perforaciones visibles, zonas oscuras o irregulares, bordes no uniformes, alto contraste local en imagen RGB"
        data-confusions="Da√±o mec√°nico por impacto, partidura incipiente, pudrici√≥n localizada, marcas por insectos"
        data-impact="Disminuye severamente la calidad comercial y aumenta el riesgo de pudrici√≥n secundaria durante almacenamiento"
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
        data-step2="Crear o seleccionar el defecto 'Picadura de p√°jaro / Bird Peck' bajo detecci√≥n por Color (RGB)."
        data-step3="Ajustar par√°metros de segmentaci√≥n y contraste para detectar perforaciones y p√©rdida de piel."
        data-step4="Validar con im√°genes recientes que incluyan diferentes tama√±os y severidades de picadura."
        data-step5="Guardar la configuraci√≥n y monitorear falsos positivos con da√±o mec√°nico similar."
        data-notes="Recomendaci√≥n: validar desde m√∫ltiples √°ngulos. Ajustar sensibilidad para no confundir con marcas superficiales o cicatrices naturales."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Picadura de p√°jaro (Bird Peck)">
        </div>
        <div class="defect-names">
          <div class="es">Picadura de p√°jaro</div>
          <div class="en">Bird Peck</div>
        </div>
      </article>

      <article class="defect-card"
        data-type="color"
        data-es="Russet"
        data-en="Russeting"
        data-img="Imagenes/Screenshot 2025-12-31 013121.png"
        data-desc="El russet corresponde a un da√±o superficial en la piel del fruto que se manifiesta como √°reas √°speras, corchosas o decoloradas. En cerezas suele asociarse a microlesiones tempranas, fricci√≥n entre frutos, condiciones ambientales (humedad/roc√≠o/lluvia) o sensibilidad varietal, afectando principalmente la apariencia."
        data-signals="Zonas opacas o mate, textura rugosa tipo corcho, parches decolorados caf√© claro/amarillentos, patr√≥n superficial irregular en imagen RGB"
        data-confusions="Cicatrices naturales, scarring por roce, marcas cosm√©ticas, residuos superficiales (polvo/suciedad), variaciones normales de brillo o color"
        data-impact="Disminuye la calidad visual y el valor comercial, generando rechazos en mercados con altos est√°ndares cosm√©ticos"
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
        data-step2="Crear o seleccionar el defecto 'Russet / Russeting' bajo detecci√≥n por Color (RGB)."
        data-step3="Ajustar par√°metros de segmentaci√≥n para identificar zonas opacas y de textura rugosa."
        data-step4="Calibrar umbrales de contraste/superficie para diferenciar russet de cicatrices, sombras o reflejos."
        data-step5="Validar con im√°genes recientes considerando distintos calibres, variedades y niveles de severidad."
        data-notes="Recomendaci√≥n: validar desde m√∫ltiples √°ngulos y condiciones de iluminaci√≥n. Evitar confundir russet leve con brillo irregular por humedad superficial."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Russet (Russeting)">
        </div>
        <div class="defect-names">
          <div class="es">Russet</div>
          <div class="en">Russeting</div>
        </div>
      </article>

      <article class="defect-card"
        data-type="color"
        data-es="Pitting"
        data-en="Pitting"
        data-img="Imagenes/DEFECTO_PITTING_COLOR.jpeg"
        data-desc="El pitting corresponde a un da√±o superficial caracterizado por peque√±as depresiones o hundimientos en la piel del fruto, generalmente causados por impacto, presi√≥n o manipulaci√≥n durante cosecha, proceso o transporte."
        data-signals="Depresiones visibles, zonas hundidas con sombra local, cambios leves de color alrededor del impacto"
        data-confusions="Da√±o mec√°nico leve, marcas de presi√≥n temporal, cicatrices superficiales"
        data-impact="Reduce la calidad visual y puede acelerar deterioro y pudrici√≥n secundaria"
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
        data-step2="Crear o seleccionar el defecto 'Pitting' bajo detecci√≥n por Color (RGB)."
        data-step3="Ajustar segmentaci√≥n para detectar depresiones y cambios locales de contraste."
        data-step4="Calibrar sensibilidad para distinguir pitting real de sombras naturales."
        data-step5="Validar con im√°genes recientes considerando distintos calibres y condiciones de iluminaci√≥n."
        data-notes="Recomendaci√≥n: validar desde m√∫ltiples √°ngulos y evitar confundir con sombreado natural."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Pitting">
        </div>
        <div class="defect-names">
          <div class="es">Pitting</div>
          <div class="en">Pitting</div>
        </div>
      </article>

      <article class="defect-card"
        data-type="color"
        data-es="Hijuelo"
        data-en="Spur"
        data-img="Imagenes/DEFECTO_HIJUELO_COLOR.jpeg"
        data-desc="El hijuelo corresponde a un defecto de forma en el que dos frutos se desarrollan parcial o totalmente unidos."
        data-signals="Forma irregular/asim√©trica, volumen superior, hendidura o l√≠nea de uni√≥n"
        data-confusions="Fruta grande normal, deformaciones leves"
        data-impact="Afecta uniformidad y reduce aceptaci√≥n comercial"
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
        data-step2="Crear o seleccionar el defecto 'Hijuelo / Spur' bajo detecci√≥n por Color (RGB)."
        data-step3="Ajustar an√°lisis de forma para detectar fusiones."
        data-step4="Calibrar umbrales de tama√±o/contorno para no confundir con fruta grande."
        data-step5="Validar con im√°genes recientes considerando grados de fusi√≥n."
        data-notes="Recomendaci√≥n: incluir fruta grande normal en sets para bajar falsos positivos."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Hijuelo (Spur)">
        </div>
        <div class="defect-names">
          <div class="es">Hijuelo</div>
          <div class="en">Spur</div>
        </div>
      </article>

      <article class="defect-card"
        data-type="color"
        data-es="Pudrici√≥n negra"
        data-en="Black Rot"
        data-img="Imagenes/DEFECTO_PUDRICION_NEGRA_COLOR.jpeg"
        data-desc="La pudrici√≥n negra corresponde a un defecto severo por descomposici√≥n, asociado a infecciones f√∫ngicas o bacterianas."
        data-signals="Zonas negras, piel colapsada/arrugada, aspecto h√∫medo, p√©rdida de forma"
        data-confusions="Manchas superficiales, fruta sobremadura, sombras"
        data-impact="Rechazo total y riesgo de contaminaci√≥n cruzada"
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
        data-step2="Crear o seleccionar 'Pudrici√≥n negra / Black Rot' por Color (RGB)."
        data-step3="Ajustar umbrales de color/brillo para zonas oscuras."
        data-step4="Calibrar segmentaci√≥n para diferenciar de sombras/manchas."
        data-step5="Validar con im√°genes recientes con distintos niveles de severidad."
        data-notes="Recomendaci√≥n: validar con iluminaci√≥n estable y excluir sobremadurez en calibraci√≥n."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Pudrici√≥n negra (Black Rot)">
        </div>
        <div class="defect-names">
          <div class="es">Pudrici√≥n negra</div>
          <div class="en">Black Rot</div>
        </div>
      </article>

      <article class="defect-card"
        data-type="color"
        data-es="Virosis"
        data-en="Virus Damage"
        data-img="Imagenes/DEFECTO_VIROSIS_COLOR.jpeg"
        data-desc="La virosis corresponde a un da√±o fisiol√≥gico causado por infecciones virales que afectan el desarrollo normal del fruto."
        data-signals="Coloraci√≥n irregular/moteada, zonas p√°lidas, deformaci√≥n leve a moderada"
        data-confusions="Variaciones naturales de color, estr√©s h√≠drico, da√±o por fr√≠o"
        data-impact="Reduce uniformidad y genera rechazos comerciales"
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
        data-step2="Crear o seleccionar 'Virosis / Virus Damage' por Color (RGB)."
        data-step3="Ajustar homogeneidad y par√°metros de moteado."
        data-step4="Calibrar para diferenciar de variaci√≥n varietal."
        data-step5="Validar con im√°genes recientes y distintos grados del da√±o."
        data-notes="Recomendaci√≥n: usar fruta confirmada con s√≠ntomas para calibraci√≥n."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Virosis (Virus Damage)">
        </div>
        <div class="defect-names">
          <div class="es">Virosis</div>
          <div class="en">Virus Damage</div>
        </div>
      </article>

      <article class="defect-card"
        data-type="color"
        data-es="Pudrici√≥n"
        data-en="Rot / Decay"
        data-img="Imagenes/Screenshot 2025-12-31 055626.png"
        data-desc="La pudrici√≥n corresponde a un proceso de descomposici√≥n del fruto causado principalmente por hongos o bacterias."
        data-signals="Zonas oscuras, √°reas blandas/colapsadas, p√©rdida de brillo, textura irregular"
        data-confusions="Golpes severos, sobremadurez, da√±o por fr√≠o avanzado"
        data-impact="P√©rdida total de calidad comercial y rechazo en destino"
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
        data-step2="Crear o seleccionar 'Pudrici√≥n / Rot' por Color (RGB)."
        data-step3="Ajustar umbrales de color/textura para zonas colapsadas."
        data-step4="Calibrar para diferenciar de golpes/sobremadurez."
        data-step5="Validar con im√°genes recientes con distintos grados."
        data-notes="Recomendaci√≥n: validar con fruta en distintos estados de avance; cuidado con golpes recientes."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 055626.png" alt="Pudrici√≥n (Rot / Decay)">
        </div>
        <div class="defect-names">
          <div class="es">Pudrici√≥n</div>
          <div class="en">Rot / Decay</div>
        </div>
      </article>

      <article class="defect-card"
  data-type="color"
  data-es="Guata blanca"
  data-en="White Pith"
  data-img="Imagenes/DEFECTO_GUATA_BLANCA_COLOR.png"
  data-desc="La guata blanca corresponde a una alteraci√≥n del tejido (principalmente alrededor de la cavidad del carozo) que se manifiesta como material blanquecino/esponjoso o zonas p√°lidas internas, y que en algunos casos puede hacerse visible externamente como √°reas opacas o decoloradas. Suele asociarse a condici√≥n fisiol√≥gica del fruto (madurez/estr√©s) y puede aumentar reclamos en destino por mala calidad al corte."
  data-signals="En RGB: √°reas opacas o p√°lidas, p√©rdida de brillo local, zonas con textura ‚Äòalgodonosa‚Äô/difusa cerca del ombligo o alrededor del eje del fruto (cuando se refleja hacia la piel). Bajo buena iluminaci√≥n se aprecia un parche blanquecino-amarillento con borde suave (no tan definido como una cicatriz)."
  data-confusions="Russet leve, bloom natural (cera), residuos de polvo/suciedad, variaci√≥n de brillo por humedad superficial, cicatrices cosm√©ticas, sobremadurez con p√©rdida de brillo."
  data-impact="Reduce la aceptaci√≥n comercial (principalmente en mercados exigentes) y puede generar reclamos por condici√≥n interna al consumo. Incrementa rechazo si se confunde con fruta ‚Äòopaca‚Äô o con da√±o fisiol√≥gico."
  data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢."
  data-step2="Seleccionar o crear el defecto (spectro) 'Guata blanca / White Pith' bajo detecci√≥n por Color (RGB)."
  data-step3="Ajustar segmentaci√≥n para capturar √°reas opacas/decoloradas (baja saturaci√≥n y brillo reducido) sin incluir sombras."
  data-step4="Calibrar umbrales para diferenciar guata blanca de bloom/cera y de russet: validar con fruta real confirmada (idealmente con corte)."
  data-step5="Validar con im√°genes recientes en distintos calibres/variedades, guardar y monitorear falsos positivos (humedad, polvo, reflejos)."
  data-notes="Recomendaci√≥n: usar sets confirmados por corte para entrenar el criterio. Revisar iluminaci√≥n y excluir fruta mojada; la humedad puede simular opacidad. Si hay mucho bloom natural, ajustar para no penalizarlo."
>
  <div class="defect-thumb">
    <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Guata blanca (White Pith)">
  </div>
  <div class="defect-names">
    <div class="es">Guata blanca</div>
    <div class="en">White Pith</div>
  </div>
</article>

<article class="defect-card"
  data-type="color"
  data-es="Inmaduro (Claro)"
  data-en="Immature (Light)"
  data-img="Imagenes/DEFECTO_INMADURO_LIGHT.png"
  data-desc="El defecto Inmaduro (Light) corresponde a fruta que presenta tonalidades m√°s claras de lo permitido para el est√°ndar de cosecha y comercializaci√≥n. Este tipo de fruta no ha alcanzado el nivel √≥ptimo de madurez, evidenci√°ndose principalmente por coloraciones p√°lidas, bajo desarrollo de pigmentaci√≥n y menor intensidad crom√°tica en la piel."
  data-signals="En color (RGB): valores de luminosidad (L*) elevados, saturaci√≥n reducida y predominio de tonos claros o deslavados. La fruta inmadura presenta menor intensidad de rojo y mayor presencia de matices amarillentos o blanquecinos."
  data-confusions="Variaciones naturales por variedad, fruta lavada con alta reflectancia, zonas sobreiluminadas, fruta firme con color heterog√©neo."
  data-impact="Afecta la homogeneidad del lote, reduce aceptaci√≥n comercial y puede generar reclamos por calidad visual y sensorial. En exportaci√≥n, suele ser clasificada en categor√≠as inferiores o descartada."
  data-step1="Abrir gpVision‚Ñ¢ y seleccionar detecci√≥n por Color (RGB)."
  data-step2="Crear o seleccionar el defecto 'Inmaduro (Light) / Immature (Light)'."
  data-step3="Ajustar umbrales de color y saturaci√≥n diferenciando fruta inmadura de fruta madura clara."
  data-step4="Validar con sets de fruta inmadura, fruta madura aceptable y fruta sobremadura."
  data-step5="Guardar la configuraci√≥n y monitorear solapamientos con defectos de madurez avanzada."
  data-notes="Recomendaci√≥n: calibrar iluminaci√≥n y balance de blancos antes de ajustar umbrales, y validar por variedad para evitar falsas detecciones en cultivares de color naturalmente claro."
>
  <div class="defect-thumb">
    <img src="Imagenes/Screenshot 2025-12-31 013121.png" alt="Inmaduro (Light) / Immature (Light)">
  </div>
  <div class="defect-names">
    <div class="es">Inmaduro (Light)</div>
    <div class="en">Immature (Light)</div>
  </div>
</article>

<article class="defect-card"
  data-type="color"
  data-es="Partidura apical"
  data-en="Apical Cracking"
  data-img="Imagenes/unnamed (1).png"
  data-desc="La partidura apical corresponde a una ruptura localizada de la piel del fruto en la zona apical (extremo opuesto al pedicelo). Este defecto se asocia principalmente a desequilibrios h√≠dricos durante la etapa de crecimiento o cercanos a cosecha, donde la presi√≥n interna supera la elasticidad de la epidermis en el √°pice del fruto."
  data-signals="En color (RGB): grietas visibles en el extremo apical, bordes irregulares o abiertos, alto contraste entre la pulpa expuesta y la piel sana. Puede observarse cambio de tonalidad alrededor de la grieta y sombras profundas en la zona afectada."
  data-confusions="Cicatrices apicales naturales, marcas cosm√©ticas superficiales, da√±o mec√°nico puntual, peque√±as hendiduras sin ruptura real de la piel."
  data-impact="Disminuye significativamente la calidad comercial, aumenta el riesgo de ingreso de pat√≥genos y acelera la deshidrataci√≥n y pudrici√≥n durante almacenamiento y transporte."
  data-step1="Abrir gpVision‚Ñ¢ y seleccionar detecci√≥n por Color (RGB)."
  data-step2="Crear o seleccionar el defecto 'Partidura apical / Apical Cracking'."
  data-step3="Ajustar par√°metros de segmentaci√≥n para priorizar detecci√≥n en la zona apical del fruto."
  data-step4="Calibrar umbrales de contraste y forma para diferenciar grietas reales de cicatrices superficiales."
  data-step5="Validar con im√°genes recientes considerando distintos calibres y niveles de apertura de la partidura."
  data-notes="Recomendaci√≥n: validar desde m√∫ltiples √°ngulos y controlar sensibilidad para evitar falsos positivos en cicatrices apicales cerradas o marcas cosm√©ticas."
>
  <div class="defect-thumb">
    <img src="Imagenes/unnamed (1).png" alt="Partidura apical / Apical Cracking">
  </div>
  <div class="defect-names">
    <div class="es">Partidura apical</div>
    <div class="en">Apical Cracking</div>
  </div>
</article>

    </div>
  </section>

  <!-- 4. DEFECTOS DETECTADOS POR INFRARROJO -->
  <section class="section" id="defectos-nir">
    <div class="section-title">
      <div class="bar"></div>
      <h2>Defectos detectados por infrarrojo (NIR)</h2>
    </div>

    <p class="section-sub">
      Los defectos detectados mediante infrarrojo cercano (NIR) corresponden a condiciones
      que no siempre son visibles externamente, pero que alteran la respuesta espectral del fruto.
      Estos defectos est√°n asociados a des√≥rdenes internos, da√±o por humedad, descomposici√≥n
      incipiente o cambios estructurales del tejido.
    </p>

    <p class="section-sub">
      En gpVision‚Ñ¢, la detecci√≥n por NIR requiere una correcta calibraci√≥n √≥ptica y un an√°lisis
      cuidadoso de la se√±al infrarroja, ya que estos defectos suelen ser sensibles a variaciones
      de temperatura, contenido de agua y estado fisiol√≥gico del fruto.
    </p>

    <div class="defects-grid">

      <article class="defect-card"
        data-type="nir"
        data-es="Blando m√≠nimo"
        data-en="Soft ‚Äì Minimum"
        data-img="Imagenes/Screenshot 2025-12-31 013802.png"
        data-desc="El defecto Blando m√≠nimo corresponde a fruta con p√©rdida leve de firmeza..."
        data-signals="Respuesta NIR m√°s opaca o con menor contraste respecto a fruta firme..."
        data-confusions="Fruta madura normal, variaciones por variedad, temperatura..."
        data-impact="Reduce la vida √∫til del fruto y aumenta el riesgo de reclamos..."
        data-step1="Abrir el m√≥dulo de configuraci√≥n de defectos en gpVision‚Ñ¢ y seleccionar NIR."
        data-step2="Crear/seleccionar 'Blando m√≠nimo / Soft ‚Äì Minimum'."
        data-step3="Ajustar sensibilidad y umbrales NIR."
        data-step4="Validar con fruta firme vs levemente blanda (ideal con referencia)."
        data-step5="Guardar y monitorear falsos positivos/negativos."
        data-notes="Recomendaci√≥n: calibrar a temperatura estable y revisar por variedad."
      >
        <div class="defect-thumb">
          <img src="Imagenes/Screenshot 2025-12-31 013802.png" alt="Blando m√≠nimo (Soft ‚Äì Minimum)">
        </div>
        <div class="defect-names">
          <div class="es">Blando m√≠nimo</div>
          <div class="en">Soft ‚Äì Minimum</div>
        </div>
      </article>

      <article class="defect-card"
        data-type="nir"
        data-es="Blando promedio"
        data-en="Soft ‚Äì Medium"
        data-img="Imagenes/unnamed (4).png"
        data-desc="El defecto Blando promedio corresponde a fruta con p√©rdida moderada de firmeza..."
        data-signals="Respuesta NIR m√°s opaca y homog√©nea, menor contraste..."
        data-confusions="Fruta madura avanzada, variaciones por variedad..."
        data-impact="Reduce significativamente la vida √∫til y aumenta reclamos..."
        data-step1="Abrir gpVision‚Ñ¢ y seleccionar detecci√≥n NIR."
        data-step2="Crear/seleccionar 'Blando promedio / Soft ‚Äì Medium'."
        data-step3="Ajustar umbrales NIR diferenci√°ndolo de madurez normal."
        data-step4="Validar con sets (firme, blando m√≠nimo y promedio)."
        data-step5="Guardar y monitorear solapamientos con blando severo."
        data-notes="Recomendaci√≥n: definir l√≠mite claro entre blando m√≠nimo y promedio."
      >
        <div class="defect-thumb">
          <img src="Imagenes/unnamed (4).png" alt="Blando promedio (Soft ‚Äì Medium)">
        </div>
        <div class="defect-names">
          <div class="es">Blando promedio</div>
          <div class="en">Soft ‚Äì Medium</div>
        </div>
      </article>

      <article class="defect-card"
  data-type="nir"
  data-es="Machuc√≥n"
  data-en="Bruise"
  data-img="Imagenes/unnamed (3).png"
  data-desc="El machuc√≥n corresponde a un da√±o interno del tejido del fruto causado por impacto, presi√≥n o manipulaci√≥n excesiva durante cosecha, proceso o transporte. En etapas iniciales, el da√±o puede no presentar se√±ales visibles externas, pero s√≠ altera la estructura celular y el contenido de agua, siendo detectable mediante infrarrojo cercano (NIR)."
  data-signals="En NIR: zonas con respuesta espectral alterada, generalmente m√°s oscuras u opacas respecto al tejido sano, con contornos difusos. La se√±al suele aparecer localizada y no necesariamente coincide con marcas visibles en RGB, especialmente en machucones recientes."
  data-confusions="Fruta blanda por madurez, da√±o fisiol√≥gico incipiente, variaciones naturales de firmeza por temperatura, guata blanca interna, sobremadurez avanzada."
  data-impact="Reduce significativamente la vida √∫til del fruto y aumenta la probabilidad de pudrici√≥n secundaria durante almacenamiento y tr√°nsito. Genera reclamos por da√±o interno no visible al despacho."
  data-step1="Abrir gpVision‚Ñ¢ y seleccionar el modo de detecci√≥n por Infrarrojo (NIR)."
  data-step2="Crear o seleccionar el defecto 'Machuc√≥n / Bruise' dentro de la configuraci√≥n NIR."
  data-step3="Ajustar sensibilidad y umbrales NIR para identificar diferencias de absorci√≥n asociadas a da√±o por impacto."
  data-step4="Validar con sets de fruta sana vs fruta machucada confirmada (idealmente mediante inspecci√≥n destructiva)."
  data-step5="Guardar la configuraci√≥n y monitorear solapamientos con defectos de blando o descomposici√≥n incipiente."
  data-notes="Recomendaci√≥n: calibrar a temperatura estable y repetir validaciones durante la jornada. Machucones recientes pueden evolucionar; revisar el comportamiento NIR a distintas horas post impacto."
>
  <div class="defect-thumb">
    <img src="Imagenes/unnamed (3).png" alt="Machuc√≥n (Bruise)">
  </div>
  <div class="defect-names">
    <div class="es">Machuc√≥n</div>
    <div class="en">Bruise</div>
  </div>
</article>

<article class="defect-card"
  data-type="nir"
  data-es="Doble (Fruto siam√©s)"
  data-en="Double / Twin Fruit"
  data-img="Imagenes/DEFECTO_DOBLE_NIR.png"
  data-desc="El defecto Doble corresponde a frutos siameses o unidos, donde dos cerezas comparten tejido parcial o total. Este tipo de defecto suele originarse por alteraciones fisiol√≥gicas durante la floraci√≥n y el desarrollo. Aunque en algunos casos es visible externamente, su identificaci√≥n confiable se realiza mediante an√°lisis infrarrojo cercano (NIR), debido a la masa, volumen y estructura interna an√≥mala del fruto."
  data-signals="En NIR: respuesta espectral irregular asociada a mayor volumen y densidad interna, con patrones de absorci√≥n no homog√©neos. Se detecta un perfil NIR m√°s complejo y extendido en comparaci√≥n con fruta simple, incluso cuando externamente parece una sola unidad."
  data-confusions="Fruta de gran calibre individual, frutos muy pr√≥ximos en el singulador, solapamiento moment√°neo en rollers, variaciones de orientaci√≥n durante la captura."
  data-impact="Afecta la uniformidad del producto final, genera problemas en embalaje y presentaci√≥n, y puede provocar errores en conteo, calibrado y llenado de envases. Generalmente no cumple con est√°ndares comerciales."
  data-step1="Abrir gpVision‚Ñ¢ y seleccionar detecci√≥n por Infrarrojo (NIR)."
  data-step2="Crear o seleccionar el defecto 'Doble / Twin Fruit' en la lista de defectos NIR."
  data-step3="Ajustar umbrales considerando volumen, firma espectral y patrones NIR asociados a fruta unida."
  data-step4="Validar con sets de fruta simple vs fruta doble confirmada visual y manualmente."
  data-step5="Guardar la configuraci√≥n y verificar que no exista solapamiento excesivo con calibres grandes normales."
  data-notes="Recomendaci√≥n: complementar la detecci√≥n NIR con informaci√≥n geom√©trica (ancho/longitud) cuando est√© disponible, y validar especialmente en variedades propensas a fruta doble."
>
  <div class="defect-thumb">
    <img src="Imagenes/Screenshot 2025-12-31 013802.png" alt="Doble (Twin Fruit)">
  </div>
  <div class="defect-names">
    <div class="es">Doble (Fruto siam√©s)</div>
    <div class="en">Double / Twin Fruit</div>
  </div>
</article>

<article class="defect-card"
  data-type="nir"
  data-es="Black Hole"
  data-en="Black Hole"
  data-img="Imagenes/DEFECTO_BLACK_HOLE_NIR.png"
  data-desc="El defecto Black Hole corresponde a cavidades profundas u orificios internos en el fruto, generalmente asociados a colapsos del tejido, pudrici√≥n localizada o da√±o interno severo. Aunque puede no ser evidente externamente en color, este defecto se identifica de forma confiable mediante an√°lisis en infrarrojo cercano (NIR), debido a la alteraci√≥n estructural del tejido interno."
  data-signals="En NIR: respuesta espectral muy atenuada y no homog√©nea en la zona afectada, con p√©rdida de continuidad en la se√±al. La cavidad genera absorci√≥n irregular y patrones NIR an√≥malos respecto a fruta sana o con defectos superficiales."
  data-confusions="Blando severo, descomposici√≥n interna avanzada, fruta sobremadura con colapso de pulpa, variaciones internas por da√±o mec√°nico no visible."
  data-impact="Reduce dr√°sticamente la calidad interna del fruto, genera rechazo en procesos de exportaci√≥n y aumenta el riesgo sanitario. Generalmente clasificado como descarte por no cumplir est√°ndares de firmeza e integridad."
  data-step1="Abrir gpVision‚Ñ¢ y seleccionar detecci√≥n por Infrarrojo Cercano (NIR)."
  data-step2="Crear o seleccionar el defecto 'Black Hole' en el cat√°logo de defectos NIR."
  data-step3="Ajustar umbrales NIR enfoc√°ndose en p√©rdida de densidad y discontinuidad de se√±al interna."
  data-step4="Validar con sets de fruta sana, blanda y fruta con cavidades internas confirmadas."
  data-step5="Guardar la configuraci√≥n y monitorear solapamientos con blando severo o pudrici√≥n interna."
  data-notes="Recomendaci√≥n: validar peri√≥dicamente con cortes f√≠sicos de fruta para asegurar la correcta separaci√≥n entre Black Hole y otros defectos internos similares."
>
  <div class="defect-thumb">
    <img src="Imagenes/Screenshot 2025-12-31 013802.png" alt="Black Hole (NIR)">
  </div>
  <div class="defect-names">
    <div class="es">Black Hole</div>
    <div class="en">Cavidad Profunda</div>
  </div>
</article>


    </div>
  </section>


    <!-- =========================
         MODAL NUEVO (HTML)
         ========================= -->
    <div class="gpModalOverlay" id="gpModalOverlay" aria-hidden="true">
      <div class="gpModal" role="dialog" aria-modal="true" aria-labelledby="gpModalTitle">
        <div class="gpModalHandle" aria-hidden="true"></div>

        <div class="gpModalHead">
          <div>
            <h3 class="gpModalTitle" id="gpModalTitle">Defecto</h3>
            <p class="gpModalSub" id="gpModalSub">Detalle t√©cnico y configuraci√≥n en gpVision‚Ñ¢</p>

            <div class="gpBadge" id="gpBadge">
              <span class="gpDot"></span>
              <span id="gpBadgeText">Detecci√≥n</span>
            </div>
          </div>

          <button class="gpClose" id="gpModalClose" type="button" aria-label="Cerrar">‚úï</button>
        </div>

        <!-- ‚úÖ El scroll vive aqu√≠ -->
        <div class="gpModalBody" id="gpModalBody">
          <div class="gpGrid">

            <section class="gpCard gpFigure">
              <div class="gpFigureImg">
                <img id="gpModalImg" src="" alt="Imagen defecto" />
              </div>
              <div class="gpCaption" id="gpModalCaption">‚Äî</div>
            </section>

            <section class="gpCard gpInfo">
              <div class="gpPad">
                <h4 class="gpCardTitle">Informaci√≥n del defecto</h4>
                <p class="gpText" id="gpDesc"></p>

                <ul class="gpList">
                  <li><b>Se√±ales principales:</b> <span id="gpSignals"></span></li>
                  <li><b>Confusiones comunes:</b> <span id="gpConfusions"></span></li>
                  <li><b>Impacto:</b> <span id="gpImpact"></span></li>
                </ul>
              </div>
            </section>

            <section class="gpCard gpSteps">
              <button class="gpAccBtn" id="gpAccBtn" type="button" aria-expanded="false" aria-controls="gpAccPanel">
                <span>Ver paso a paso (gpVision‚Ñ¢)</span>
                <span class="gpAccIcon" aria-hidden="true">‚ñæ</span>
              </button>

              <div class="gpAccPanel" id="gpAccPanel" hidden>
                <div class="gpStepsGrid">
                  <div class="gpStep"><div class="gpStepN">Paso 1</div><div class="gpStepT" id="gpStep1"></div></div>
                  <div class="gpStep"><div class="gpStepN">Paso 2</div><div class="gpStepT" id="gpStep2"></div></div>
                  <div class="gpStep"><div class="gpStepN">Paso 3</div><div class="gpStepT" id="gpStep3"></div></div>
                  <div class="gpStep"><div class="gpStepN">Paso 4</div><div class="gpStepT" id="gpStep4"></div></div>
                  <div class="gpStep"><div class="gpStepN">Paso 5</div><div class="gpStepT" id="gpStep5"></div></div>
                </div>

                <p class="gpNote"><b>Notas:</b> <span id="gpNotes"></span></p>
              </div>
            </section>

          </div>
        </div>
      </div>
    </div>

    <!-- Lightbox -->
    <div class="gpLightbox" id="gpLightbox" aria-hidden="true">
      <img id="gpLightboxImg" alt="">
    </div>

  </main>

  <footer>
    Defectos ¬∑ GP Graders ¬∑ Documentaci√≥n t√©cnica interna
  </footer>

  <script>
    /* =========================
       REVEAL (buscador + selector + cards)
       ========================= */
    (function(){
      const targets = document.querySelectorAll(".search-wrap, .defect-selector, .defect-card");
      if(!targets.length) return;

      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            e.target.classList.add("reveal");
            io.unobserve(e.target);
          }
        });
      }, { threshold: 0.14 });

      targets.forEach((el, i)=>{
        if(el.classList.contains("defect-card")){
          el.style.transitionDelay = `${Math.min(i * 45, 420)}ms`;
        }
        io.observe(el);
      });
    })();

    /* =========================
       BUSCADOR + AUTOCOMPLETE (igual idea, mantenido)
       ========================= */
    const searchInput = document.getElementById("searchInput");
    const suggestList = document.getElementById("suggestList");
    const searchBtn = document.getElementById("searchBtn");
    const clearBtn = document.getElementById("clearSearchBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const meta = document.getElementById("searchMeta");

    let hits = [];
    let activeIndex = -1;

    let indexItems = [];
    let suggestActive = -1;
    const MAX_SUGGEST = 8;
    const SKIP_TAGS = new Set(["SCRIPT","STYLE","INPUT","TEXTAREA","BUTTON","IFRAME","MARK"]);

    function escapeRegExp(str){ return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); }

    function clearMarks(){
      document.querySelectorAll("mark.gp-hit").forEach(m => {
        const t = document.createTextNode(m.textContent);
        m.replaceWith(t);
      });
      hits = [];
      activeIndex = -1;
    }

    function setActive(idx){
      if(!hits.length) return;
      hits.forEach(h => h.classList.remove("active"));
      activeIndex = (idx + hits.length) % hits.length;
      hits[activeIndex].classList.add("active");
      hits[activeIndex].scrollIntoView({ behavior:"smooth", block:"center" });
      meta.textContent = `Coincidencias: ${hits.length} ¬∑ Mostrando ${activeIndex + 1}/${hits.length}`;
    }

    function highlight(term){
      clearMarks();
      if(!term) { meta.textContent = "Sin b√∫squeda activa."; return; }

      const root = document.querySelector("main");
      const rx = new RegExp(escapeRegExp(term), "gi");

      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
        acceptNode(node){
          if(!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
          const p = node.parentElement;
          if(!p) return NodeFilter.FILTER_REJECT;
          if(SKIP_TAGS.has(p.tagName)) return NodeFilter.FILTER_REJECT;
          return NodeFilter.FILTER_ACCEPT;
        }
      });

      const nodes = [];
      while(walker.nextNode()) nodes.push(walker.currentNode);

      nodes.forEach(node => {
        const txt = node.nodeValue;
        if(!rx.test(txt)) return;

        rx.lastIndex = 0;
        const frag = document.createDocumentFragment();
        let last = 0;
        let m;

        while((m = rx.exec(txt)) !== null){
          const start = m.index;
          const end = start + m[0].length;
          if(start > last) frag.appendChild(document.createTextNode(txt.slice(last, start)));

          const mark = document.createElement("mark");
          mark.className = "gp-hit";
          mark.textContent = txt.slice(start, end);
          frag.appendChild(mark);

          last = end;
        }
        if(last < txt.length) frag.appendChild(document.createTextNode(txt.slice(last)));
        node.parentNode.replaceChild(frag, node);
      });

      hits = Array.from(document.querySelectorAll("mark.gp-hit"));
      if(hits.length) setActive(0);
      else meta.textContent = "No se encontraron coincidencias.";
    }

    function buildIndex(){
      const root = document.querySelector("main");
      indexItems = [];

      root.querySelectorAll("h1,h2,h3,h4").forEach((el, i) => {
        const t = (el.innerText || "").trim();
        if(t.length >= 3) indexItems.push({ id: `h-${i}`, text: t, el });
      });

      root.querySelectorAll("li").forEach((el, i) => {
        const t = (el.innerText || "").trim();
        if(t.length >= 12) indexItems.push({ id: `li-${i}`, text: t.slice(0, 220), el });
      });

      root.querySelectorAll(".section-sub").forEach((el, i) => {
        const t = (el.innerText || "").trim();
        if(t.length >= 18) indexItems.push({ id: `p-${i}`, text: t.slice(0, 220), el });
      });

      document.querySelectorAll(".defect-card").forEach((card, i) => {
        const es = (card.dataset.es || "").trim();
        const en = (card.dataset.en || "").trim();
        const desc = (card.dataset.desc || "").trim();
        const signals = (card.dataset.signals || "").trim();
        const conf = (card.dataset.confusions || "").trim();
        const line = [es, en, desc, signals, conf].join(" ¬∑ ").slice(0, 260);
        if(line.length >= 6) indexItems.push({ id: `c-${i}`, text: line, el: card });
      });
    }

    function norm(s){
      return (s || "").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
    }
    function scoreMatch(query, text){
      const q = norm(query), t = norm(text);
      if(!q) return -1;
      const idx = t.indexOf(q);
      if(idx === -1) return -1;

      let score = 0;
      if(idx === 0) score += 6;
      score += Math.max(0, 5 - Math.min(idx, 5));
      score += Math.min(q.length / 4, 4);
      return score;
    }
    function hiText(text, query){
      const q = query.trim();
      if(!q) return text;
      const rx = new RegExp(escapeRegExp(q), "ig");
      return text.replace(rx, (m)=>`<span class="suggest-hi">${m}</span>`);
    }
    function hideSuggest(){
      suggestList.style.display = "none";
      suggestList.innerHTML = "";
      suggestActive = -1;
    }
    function showSuggest(items, query){
      if(!items.length){ hideSuggest(); return; }
      suggestList.innerHTML = items.map((it, idx) => {
        const line = it.text.length > 120 ? it.text.slice(0, 120) + "‚Ä¶" : it.text;
        return `
          <div class="suggest-item" data-idx="${idx}">
            <div class="suggest-title">${hiText(line, query)}</div>
          </div>
        `;
      }).join("");
      suggestList.style.display = "block";
    }
    function getSuggestions(query){
      const q = query.trim();
      if(q.length < 1) return [];
      return indexItems
        .map(it => ({ it, s: scoreMatch(q, it.text) }))
        .filter(x => x.s >= 0)
        .sort((a,b) => b.s - a.s)
        .slice(0, MAX_SUGGEST)
        .map(x => x.it);
    }
    function jumpToElement(el, query){
      if(!el) return;
      el.scrollIntoView({ behavior:"smooth", block:"center" });
      highlight(query);
      if(hits.length) setActive(0);
      hideSuggest();
    }

    buildIndex();

    searchInput?.addEventListener("input", () => {
      const q = searchInput.value;
      const suggestions = getSuggestions(q);
      showSuggest(suggestions, q);
    });

    suggestList?.addEventListener("click", (e) => {
      const item = e.target.closest(".suggest-item");
      if(!item) return;
      const q = searchInput.value.trim();
      const suggestions = getSuggestions(q);
      const idx = Number(item.dataset.idx);
      const it = suggestions[idx];
      if(it) jumpToElement(it.el, q);
    });

    searchInput?.addEventListener("keydown", (e)=>{
      const q = searchInput.value.trim();
      const suggestions = getSuggestions(q);
      if(!suggestions.length) return;

      const items = Array.from(suggestList.querySelectorAll(".suggest-item"));

      if(e.key === "ArrowDown"){
        e.preventDefault();
        suggestActive = (suggestActive + 1) % items.length;
        items.forEach(x => x.classList.remove("active"));
        items[suggestActive].classList.add("active");
        items[suggestActive].scrollIntoView({ block:"nearest" });
      }
      if(e.key === "ArrowUp"){
        e.preventDefault();
        suggestActive = (suggestActive - 1 + items.length) % items.length;
        items.forEach(x => x.classList.remove("active"));
        items[suggestActive].classList.add("active");
        items[suggestActive].scrollIntoView({ block:"nearest" });
      }
      if(e.key === "Enter"){
        if(suggestActive >= 0 && suggestions[suggestActive]){
          e.preventDefault();
          jumpToElement(suggestions[suggestActive].el, q);
        }else{
          highlight(q);
          hideSuggest();
        }
      }
      if(e.key === "Escape"){ hideSuggest(); }
    });

    document.addEventListener("click", (e)=>{
      const wrap = e.target.closest(".search-wrap");
      if(!wrap) hideSuggest();
    });

    searchBtn?.addEventListener("click", () => {
      const q = searchInput.value.trim();
      highlight(q);
      hideSuggest();
    });

    nextBtn?.addEventListener("click", ()=> setActive(activeIndex + 1));
    prevBtn?.addEventListener("click", ()=> setActive(activeIndex - 1));

    clearBtn?.addEventListener("click", ()=>{
      searchInput.value = "";
      clearMarks();
      meta.textContent = "Sin b√∫squeda activa.";
      hideSuggest();
    });

    document.querySelectorAll(".defect-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const targetId = btn.dataset.target;
        const target = document.getElementById(targetId);
        if(target) target.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    });

    /* =========================
       MODAL NUEVO + LIGHTBOX
       - scroll real m√≥vil (gpModalBody)
       - cierra con click afuera + ESC
       - oculta header cuando abre (body.modal-open)
       ========================= */
    (function(){
      const overlay = document.getElementById("gpModalOverlay");
      const modal = overlay?.querySelector(".gpModal");
      const closeBtn = document.getElementById("gpModalClose");

      const title = document.getElementById("gpModalTitle");
      const sub = document.getElementById("gpModalSub");

      const badge = document.getElementById("gpBadge");
      const badgeText = document.getElementById("gpBadgeText");

      const img = document.getElementById("gpModalImg");
      const caption = document.getElementById("gpModalCaption");

      const desc = document.getElementById("gpDesc");
      const signals = document.getElementById("gpSignals");
      const confusions = document.getElementById("gpConfusions");
      const impact = document.getElementById("gpImpact");

      const accBtn = document.getElementById("gpAccBtn");
      const accPanel = document.getElementById("gpAccPanel");

      const s1 = document.getElementById("gpStep1");
      const s2 = document.getElementById("gpStep2");
      const s3 = document.getElementById("gpStep3");
      const s4 = document.getElementById("gpStep4");
      const s5 = document.getElementById("gpStep5");
      const notes = document.getElementById("gpNotes");

      // Lightbox
      const lb = document.getElementById("gpLightbox");
      const lbImg = document.getElementById("gpLightboxImg");

      let lastFocus = null;

      function lockBody(){
        document.body.classList.add("modal-open");
        document.body.style.overflow = "hidden";
      }
      function unlockBody(){
        document.body.classList.remove("modal-open");
        document.body.style.overflow = "";
      }

      function setAccordion(open){
        if(!accBtn || !accPanel) return;
        accBtn.setAttribute("aria-expanded", open ? "true" : "false");
        accPanel.hidden = !open;
      }

      accBtn?.addEventListener("click", ()=>{
        const isOpen = accBtn.getAttribute("aria-expanded") === "true";
        setAccordion(!isOpen);
      });

      function openModal(card){
        lastFocus = document.activeElement;

        const es = card.dataset.es || "Defecto";
        const en = card.dataset.en || "";
        const type = (card.dataset.type || "").toLowerCase();

        title.textContent = `${es} (${en})`;
        sub.textContent = "Detalle t√©cnico y configuraci√≥n en gpVision‚Ñ¢";

        img.src = card.dataset.img || "";
        img.alt = `${es} (${en})`;
        caption.textContent = card.dataset.caption || "";

        desc.textContent = card.dataset.desc || "";
        signals.textContent = card.dataset.signals || "";
        confusions.textContent = card.dataset.confusions || "";
        impact.textContent = card.dataset.impact || "";

        s1.textContent = card.dataset.step1 || "";
        s2.textContent = card.dataset.step2 || "";
        s3.textContent = card.dataset.step3 || "";
        s4.textContent = card.dataset.step4 || "";
        s5.textContent = card.dataset.step5 || "";
        notes.textContent = card.dataset.notes || "";

        badge.classList.remove("nir");
        if(type === "nir"){
          badge.classList.add("nir");
          badgeText.textContent = "Detecci√≥n: Infrarrojo (NIR)";
        }else{
          badgeText.textContent = "Detecci√≥n: Color (RGB)";
        }

        setAccordion(false);

        overlay.classList.add("is-open");
        overlay.setAttribute("aria-hidden","false");
        lockBody();

        // enfocar cierre
        closeBtn?.focus?.({ preventScroll:true });
      }

      function closeModal(){
        overlay.classList.remove("is-open");
        overlay.setAttribute("aria-hidden","true");
        unlockBody();
        setAccordion(false);

        // si lightbox abierto, cerrar
        if(lb.classList.contains("is-open")) closeLightbox();

        // devolver focus
        if(lastFocus && lastFocus.focus) lastFocus.focus({ preventScroll:true });
      }

      // click cards
      document.querySelectorAll(".defect-card").forEach(card=>{
        card.addEventListener("click", ()=> openModal(card));
      });

      // cerrar
      closeBtn?.addEventListener("click", closeModal);

      // click fuera
      overlay?.addEventListener("click", (e)=>{
        if(e.target === overlay) closeModal();
      });

      // ESC
      document.addEventListener("keydown", (e)=>{
        if(e.key !== "Escape") return;
        if(lb.classList.contains("is-open")) closeLightbox();
        else if(overlay.classList.contains("is-open")) closeModal();
      });

      // Lightbox
      img?.addEventListener("click", ()=>{
        if(!img.src) return;
        lbImg.src = img.src;
        lbImg.alt = img.alt || "";
        lb.classList.add("is-open");
        lb.setAttribute("aria-hidden","false");
      });

      function closeLightbox(){
        lb.classList.remove("is-open");
        lb.setAttribute("aria-hidden","true");
        lbImg.src = "";
      }

      lb?.addEventListener("click", closeLightbox);
    })();
  </script>
</body>
</html>
